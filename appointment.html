<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Appointments - Global Hospital</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="form-card">
    <h2>Book Appointment</h2>
    <input type="text" id="patientName" placeholder="Patient Name" />
    <label for="doctorSelect">Select Doctor:</label>
    <select id="doctorSelect">
      <option disabled selected>Select Doctor</option>
    </select>
    <input type="date" id="appointmentDate" />
    <button id="bookBtn">Book</button>
    <ul id="appointmentList"></ul>
    <br><a href="index.html" class="back-button">→ Back to Home</a>
  </div>

  <!-- ✅ Firebase script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    // ✅ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyALDkSWZRuKcG7Gfn9w1agvnWtma3qmPVc",
      authDomain: "hmm1-84404.firebaseapp.com",
      projectId: "hmm1-84404",
      storageBucket: "hmm1-84404.appspot.com",
      messagingSenderId: "380112403059",
      appId: "1:380112403059:web:7879897802d5ca46e4c806"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ✅ Load doctors from Firestore
    async function loadDoctors() {
      const select = document.getElementById("doctorSelect");
      select.innerHTML = '<option disabled selected>Select Doctor</option>';
      try {
        const querySnapshot = await getDocs(collection(db, "doctors"));
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const option = document.createElement("option");
          option.value = data.name;
          option.textContent = `${data.name} - ${data.spec}`;
          select.appendChild(option);
        });
      } catch (e) {
        console.error("Error loading doctors:", e);
      }
    }

    // ✅ Load appointments
    async function loadAppointments() {
      try {
        const querySnapshot = await getDocs(collection(db, "appointments"));
        const list = document.getElementById("appointmentList");
        list.innerHTML = "";
        querySnapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement("li");
          li.textContent = `${data.patient} - ${data.doctor} - ${data.date}`;
          list.appendChild(li);
        });
      } catch (e) {
        console.error("Error fetching appointments:", e);
      }
    }

    // ✅ Add new appointment
    async function addAppointment() {
      const patient = document.getElementById("patientName").value.trim();
      const doctor = document.getElementById("doctorSelect").value;
      const dateValue = document.getElementById("appointmentDate").value;

      if (!patient || !doctor || !dateValue) {
        alert("Please fill all fields.");
        return;
      }

      const date = new Date(dateValue);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      if (date <= today) {
        alert("Please choose a future date.");
        return;
      }

      try {
        await addDoc(collection(db, "appointments"), {
          patient,
          doctor,
          date: date.toDateString(),
          timestamp: date.getTime()
        });
        alert("✅ Appointment booked!");
        loadAppointments();
        // clear fields
        document.getElementById("patientName").value = '';
        document.getElementById("appointmentDate").value = '';
      } catch (e) {
        console.error("Error adding appointment:", e);
        alert("❌ Failed to book appointment.");
      }
    }

    // ✅ Setup event & load data on page load
    window.onload = () => {
      loadDoctors();
      loadAppointments();
      document.getElementById("bookBtn").addEventListener("click", addAppointment);
    }
  </script>
</body>
</html>

